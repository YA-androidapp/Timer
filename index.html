<form name="timer">
発表+質疑　　<input type="text" value="0" class="a m">m
<input type="text" value="10" class="a s">s<hr><br>
1鈴　　　　残り<input type="text" value="0" class="m">m
<input type="text" value="05" class="s">s<br>
2鈴　　　　残り<input type="text" value="0" class="m">m
<input type="text" value="03" class="s">s<br><br><br><br>
<input type="button" value="Start" onclick="cntStart()">
<input type="button" value="Stop" onclick="cntStop()">
<input type="button" value="Reset" onclick="reSet()">
<br><br><br><br><br><br>
<progress id="p" max=1000 value=0><span>0</span>%</progress>
</form>

<style type="text/css">
  input[type=text].m{border:0 #fff none;font-size:5em;width:3em;text-align:right;}
  input[type=text].s{border:0 #fff none;font-size:5em;width:1.5em;text-align:right;}
  input[type=text].a{border:1px #000 solid;}
  input[type=button]{font-size:3em;width:3em;text-align:center;}
  progress{height:5em;width:500px;}
</style>

<script>
var audio = new Audio();
var audioArr = ['bell1.wav','bell2.wav','bell3.wav',];
var alltime = 0;
var flag = -1;
var progressBar = document.getElementById('p');
var timer1;

function updateProgress(newValue){
  progressBar.value = Math.round(newValue);
  progressBar.getElementsByTagName('span')[0].textContent = newValue;
}

function playAudio(num){
  audio.src = audioArr[num-1];
  audio.play();
}

function cntStart(){
  min=document.timer.elements[0].value;
  sec=document.timer.elements[1].value;
  alltime=parseInt(min)*60+parseInt(sec);

  document.timer.elements[2].disabled=true;
  document.timer.elements[3].disabled=true;
  document.timer.elements[4].disabled=true;
  document.timer.elements[5].disabled=true;
  timer1=setInterval("countDown()",1000);
}

function cntStop(){
  document.timer.elements[2].disabled=false;
  document.timer.elements[3].disabled=false;
  document.timer.elements[4].disabled=false;
  document.timer.elements[5].disabled=false;
  clearInterval(timer1);
}

function countDown(){
  var min3=document.timer.elements[0].value;
  var sec3=document.timer.elements[1].value;
  if((min3=="") && (sec3=="")) min3=15;
  if (min3=="") min3=0;
  min3=parseInt(min3);
  if (sec3=="") sec3=0;
  sec3=parseInt(sec3);

  if ((min3*60+sec3)==0){
    flag=1;
    document.timer.elements[0].style.color = "red";
    document.timer.elements[1].style.color = "red";
    progressBar.style.backgroundColor = "red";
  }

  tmWrite(min3*60+sec3+flag);
}

function tmWrite(int){
  int=parseInt(int);
  var min3=document.timer.elements[0].value;
  var sec3=document.timer.elements[1].value;
  var min1=document.timer.elements[2].value;
  var sec1=document.timer.elements[3].value;
  var min2=document.timer.elements[4].value;
  var sec2=document.timer.elements[5].value;
  if (min1=="") min1=0;
  min1=parseInt(min1);
  if (sec1=="") sec1=0;
  sec1=parseInt(sec1);
  if (min2=="") min2=0;
  min2=parseInt(min2);
  if (sec2=="") sec2=0;
  sec2=parseInt(sec2);
  if (min3=="") min3=0;
  min3=parseInt(min3);
  if (sec3=="") sec3=0;
  sec3=parseInt(sec3);

  document.timer.elements[0].value=Math.floor(int/60);
  document.timer.elements[1].value=( '0' + int % 60 ).slice( -2 );

  if (flag==-1) updateProgress(1000*(alltime-int)/alltime);

  if( (min3*60+sec3-1)==(min1*60+sec1) ){
    if (flag==-1) playAudio(1);
  }else if( (min3*60+sec3-1)==(min2*60+sec2) ){
    if (flag==-1) playAudio(2);
  }else if(int<=0){
    playAudio(3);
  }
}

function reSet(){
  flag=-1;
  document.timer.elements[0].value="0";
  document.timer.elements[1].value="10";
  document.timer.elements[2].value="0";
  document.timer.elements[3].value="05";
  document.timer.elements[4].value="0";
  document.timer.elements[5].value="03";
  document.timer.elements[2].disabled=false;
  document.timer.elements[3].disabled=false;
  document.timer.elements[4].disabled=false;
  document.timer.elements[5].disabled=false;
  updateProgress(0);
  clearInterval(timer1);
}
</script>

