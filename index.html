<!DOCTYPE html>
<html>
<head>
<title>YA-androidapp/Timer</title>
<meta charset="utf-8">
<meta name="description" content="YA-androidapp/Timer">
<meta name="author" content="YA-androidapp">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">
  input[type=text].m{border:0 #fff none;font-size:4em;width:1.5em;text-align:right;}
  input[type=text].s{border:0 #fff none;font-size:4em;width:1.5em;text-align:right;}
  input[type=text].a{border:1px #000 solid;}
  input[type=button]{font-size:3em;width:90%;text-align:center;}
  progress{height:5em;width:95%;}
  table{width:600px;}
</style>
</head>
<body>
<form name="timer">
  <table>
    <tr>
      <td>発表+質疑</td>
      <td>残り<input type="text" value="30" id="dm" class="a m" onchange="updateDb1();updateDb2();">:
             <input type="text" value="00" id="ds" class="a s" onchange="updateDb1();updateDb2();"></td>
      <td><input type="text" value="0" id="im" class="m" onchange="updateDb1();updateDb2();" readonly>:
          <input type="text" value="00" id="is" class="s" onchange="updateDb1();updateDb2();" readonly>経過</td>
    </tr>
    <tr>
      <td>2鈴</td>
      <td>残り<input type="text" value="10" id="db2m" class="m" readonly>:
             <input type="text" value="00" id="db2s" class="s" readonly></td>
      <td><input type="text" value="20" id="ib2m" class="a m" onchange="updateDb2()">:
          <input type="text" value="00" id="ib2s" class="a s" onchange="updateDb2()">経過</td>
    </tr>
    <tr>
      <td>1鈴</td>
      <td>残り<input type="text" value="20" id="db1m" class="m" readonly>:
             <input type="text" value="00" id="db1s" class="s" readonly></td>
      <td><input type="text" value="10" id="ib1m" class="a m" onchange="updateDb1()">:
          <input type="text" value="00" id="ib1s" class="a s" onchange="updateDb1()">経過</td>
    </tr>
  </table>
  <table>
    <tr>
      <td><input type="button" value="Start" id="start" onclick="cntStart()"></td>
      <td><input type="button" value="Stop" onclick="cntStop()"></td>
      <td><input type="button" value="Reset" onclick="reSet()"></td>
    </tr>
    <tr>
      <td colspan=3><progress id="p" max=1000 value=0><span>0</span>%</progress></td>
    </tr>
  </table>
</form>
<br><br><br><br><br><hr>
Copyright &copy; 2014-2015 <a href="https://github.com/YA-androidapp">YA-androidapp</a> All rights reserved.

<script>
var audio = new Audio();
var audioArr = ['bell1.wav','bell2.wav','bell3.wav',];
var alltime = 0, allmin = 0, allsec = 0, preIb1m = 0, preIb1s = 0, preIb2m = 0, preIb2s = 0;
var flag = -1;
var progressBar = document.getElementById("p");
var timer1;

function updateDb1(){
  dm=parseInt(document.getElementById("dm").value);
  ds=parseInt(document.getElementById("ds").value);
  ib1m=parseInt(document.getElementById("ib1m").value);
  ib1s=parseInt(document.getElementById("ib1s").value);
  if((ib1m==0)&&(ib1s==0)) return;
  db1=dm*60+ds-ib1m*60-ib1s;
  if (db1>=0){
    document.getElementById("db1m").value=Math.floor(db1/60);
    document.getElementById("db1s").value=( '0' + db1 % 60 ).slice( -2 );
  }else{
    document.getElementById("ib1m").value=document.getElementById("dm").value;
    document.getElementById("ib1s").value=( '0' + document.getElementById("ds").value % 60 ).slice( -2 );
    document.getElementById("db1m").value="0";
    document.getElementById("db1s").value="00";
  }
}

function updateDb2(){
  dm=parseInt(document.getElementById("dm").value);
  ds=parseInt(document.getElementById("ds").value);
  ib2m=parseInt(document.getElementById("ib2m").value);
  ib2s=parseInt(document.getElementById("ib2s").value);
  if((ib2m==0)&&(ib2s==0)) return;
  db2=dm*60+ds-ib2m*60-ib2s;
  if (db2>=0){
    document.getElementById("db2m").value=Math.floor(db2/60);
    document.getElementById("db2s").value=( '0' + db2 % 60 ).slice( -2 );
  }else{
    document.getElementById("ib2m").value=document.getElementById("dm").value;
    document.getElementById("ib2s").value=( '0' + document.getElementById("ds").value % 60 ).slice( -2 );
    document.getElementById("db2m").value="0";
    document.getElementById("db2s").value="00";
  }
}

function updateProgress(newValue){
  progressBar.value=Math.round(newValue);
  progressBar.getElementsByTagName('span')[0].textContent=newValue;
}

function playAudio(num){
  audio.src=audioArr[num-1];
  audio.play();
}

function cntStart(){
  updateDb1();
  updateDb2();

  allmin=parseInt(document.getElementById("dm").value);
  allsec=parseInt(document.getElementById("ds").value);
  preIb1m=parseInt(document.getElementById("ib1m").value);
  preIb1s=parseInt(document.getElementById("ib1s").value);
  preIb2m=parseInt(document.getElementById("ib2m").value);
  preIb2s=parseInt(document.getElementById("ib2s").value);
  alltime=allmin*60+allsec;

  setDis(true);
  document.getElementById("start").disabled=true;
  timer1=setInterval("countDown()",1000);
}

function cntStop(){
  setDis(false);
  document.getElementById("start").disabled=false;
  clearInterval(timer1);
}

function countDown(){
  var dm=parseInt(document.getElementById("dm").value);
  var ds=parseInt(document.getElementById("ds").value);
  var db1m=parseInt(document.getElementById("db1m").value);
  var db1s=parseInt(document.getElementById("db1s").value);
  var db2m=parseInt(document.getElementById("db2m").value);
  var db2s=parseInt(document.getElementById("db2s").value);

  int=dm*60+ds+flag;
  if (flag==-1) updateProgress(1000*(alltime-int)/alltime);
  if( (dm*60+ds-1)==(db1m*60+db1s) ){
    if (flag==-1){
      playAudio(1);
      setCol("yellow");
    }
  }else if( (dm*60+ds-1)==(db2m*60+db2s) ){
    if (flag==-1){
      playAudio(2);
      setCol("orange");
    }
  }else if(int<=0){
    flag=1;
    playAudio(3);
    setCol("red");
  }
  document.getElementById("dm").value=Math.floor(int/60);
  document.getElementById("ds").value=( '0' + int % 60 ).slice( -2 );
  document.getElementById("im").value=Math.floor((alltime+flag*int)/60);
  document.getElementById("is").value=( '0' + (alltime+flag*int) % 60 ).slice( -2 );
}

function setDis(dis){
  document.getElementById("db1m").disabled=dis;
  document.getElementById("db1s").disabled=dis;
  document.getElementById("db2m").disabled=dis;
  document.getElementById("db2s").disabled=dis;
  document.getElementById("ib1m").disabled=dis;
  document.getElementById("ib1s").disabled=dis;
  document.getElementById("ib2m").disabled=dis;
  document.getElementById("ib2s").disabled=dis;
}

function setCol(col){
  document.getElementById("dm").style.color = col;
  document.getElementById("ds").style.color = col;
  document.getElementById("im").style.color = col;
  document.getElementById("is").style.color = col;
}

function reSet(){
  flag=-1;
  document.getElementById("dm").value=allmin;
  document.getElementById("ds").value=( '0' + allsec ).slice( -2 );
  document.getElementById("im").value="0";
  document.getElementById("is").value="00";
  document.getElementById("ib1m").value=preIb1m;
  document.getElementById("ib1s").value=( '0' + preIb1s ).slice( -2 );
  document.getElementById("ib2m").value=preIb2m;
  document.getElementById("ib2s").value=( '0' + preIb2s ).slice( -2 );
  updateDb1();
  updateDb2();
  setDis(false);
  setCol("");
  updateProgress(0);
  clearInterval(timer1);
}
</script>
</body>
</html>
